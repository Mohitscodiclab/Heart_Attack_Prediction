<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="icon.png" type="image/png">
    <title>Heart Disease Predictor</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
            padding: 20px;
            text-align: center;
        }
        
        header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }
        
        .content {
            display: flex;
            flex-wrap: wrap;
        }
        
        .form-section {
            flex: 1;
            min-width: 300px;
            padding: 30px;
        }
        
        .result-section {
            flex: 1;
            min-width: 300px;
            padding: 30px;
            background-color: #f8f9fa;
            border-left: 1px solid #e9ecef;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }
        
        input, select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
        }
        
        input:focus, select:focus {
            outline: none;
            border-color: #6a11cb;
            box-shadow: 0 0 0 2px rgba(106, 17, 203, 0.2);
        }
        
        .btn {
            background: linear-gradient(135deg, #6a11cb 0%, #2575fc 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: transform 0.2s, box-shadow 0.2s;
            display: inline-block;
            margin-top: 10px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(106, 17, 203, 0.3);
        }
        
        .btn-secondary {
            background: #6c757d;
            margin-left: 10px;
        }
        
        .btn-secondary:hover {
            box-shadow: 0 5px 15px rgba(108, 117, 125, 0.3);
        }
        
        .result-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
        }
        
        .result-card h3 {
            margin-bottom: 15px;
            color: #333;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 10px;
        }
        
        .prediction-result {
            font-size: 1.2rem;
            font-weight: 600;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            margin: 20px 0;
        }
        
        .high-risk {
            background-color: #ffebee;
            color: #c62828;
            border: 1px solid #ffcdd2;
        }
        
        .moderate-risk {
            background-color: #fff8e1;
            color: #ff8f00;
            border: 1px solid #ffecb3;
        }
        
        .low-risk {
            background-color: #e8f5e9;
            color: #2e7d32;
            border: 1px solid #c8e6c9;
        }
        
        .risk-meter {
            height: 20px;
            background: #e0e0e0;
            border-radius: 10px;
            margin: 15px 0;
            overflow: hidden;
        }
        
        .risk-meter-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 1s ease-in-out;
        }
        
        .risk-low {
            background: linear-gradient(90deg, #4caf50, #8bc34a);
        }
        
        .risk-moderate {
            background: linear-gradient(90deg, #ffeb3b, #ff9800);
        }
        
        .risk-high {
            background: linear-gradient(90deg, #ff5722, #f44336);
        }
        
        .history-section {
            padding: 30px;
            border-top: 1px solid #e9ecef;
        }
        
        .history-item {
            background: white;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .history-date {
            color: #6c757d;
            font-size: 0.9rem;
        }
        
        .history-risk {
            font-weight: 600;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 0.9rem;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            background: white;
            border-radius: 8px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            transform: translateX(120%);
            transition: transform 0.3s ease-out;
            z-index: 1000;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .notification.success {
            border-left: 4px solid #4caf50;
        }
        
        .notification.error {
            border-left: 4px solid #f44336;
        }
        
        .tabs {
            display: flex;
            border-bottom: 1px solid #e9ecef;
            margin-bottom: 20px;
        }
        
        .tab {
            padding: 12px 20px;
            cursor: pointer;
            font-weight: 600;
            color: #6c757d;
            border-bottom: 3px solid transparent;
            transition: all 0.2s;
        }
        
        .tab.active {
            color: #6a11cb;
            border-bottom-color: #6a11cb;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .factor {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            padding-bottom: 10px;
            border-bottom: 1px dashed #eee;
        }
        
        .factor-name {
            font-weight: 500;
        }
        
        .factor-impact {
            font-weight: 600;
        }
        
        .impact-low {
            color: #4caf50;
        }
        
        .impact-moderate {
            color: #ff9800;
        }
        
        .impact-high {
            color: #f44336;
        }
        
        .model-info {
            font-size: 0.85rem;
            color: #6c757d;
            margin-top: 15px;
            font-style: italic;
        }
        
        .advanced-toggle {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 8px;
        }
        
        .advanced-toggle input {
            width: auto;
            margin-right: 10px;
        }
        
        .advanced-section {
            display: none;
            margin-top: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }
        
        .advanced-section.active {
            display: block;
        }
        
        .advanced-section h3 {
            margin-bottom: 15px;
            color: #6a11cb;
        }
        
        @media (max-width: 768px) {
            .content {
                flex-direction: column;
            }
            
            .result-section {
                border-left: none;
                border-top: 1px solid #e9ecef;
            }
            
            header h1 {
                font-size: 2rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>❤️ Heart Disease Predictor</h1>
            <p>Advanced AI-powered heart disease risk assessment</p>
        </header>
        
        <div class="tabs">
            <div class="tab active" onclick="switchTab('predict')">Predict Risk</div>
            <div class="tab" onclick="switchTab('history')">History</div>
        </div>
        
        <div class="content">
            <div id="predict-tab" class="tab-content active">
                <div class="form-section">
                    <h2>Patient Information</h2>
                    <form id="predictionForm">
                        <div class="advanced-toggle">
                            <input type="checkbox" id="advancedMode" onchange="toggleAdvancedMode()">
                            <label for="advancedMode">Enable Advanced Mode (for clinical use)</label>
                        </div>
                        
                        <div class="form-group">
                            <label for="name">Full Name</label>
                            <input type="text" id="name" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="age">Age</label>
                            <input type="number" id="age" min="1" max="120" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="gender">Gender</label>
                            <select id="gender" required>
                                <option value="">Select Gender</option>
                                <option value="male">Male</option>
                                <option value="female">Female</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="bloodPressure">Blood Pressure (mmHg)</label>
                            <input type="number" id="bloodPressure" min="50" max="250" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="cholesterol">Cholesterol (mg/dL)</label>
                            <input type="number" id="cholesterol" min="100" max="400" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="bloodSugar">Blood Sugar (mg/dL)</label>
                            <input type="number" id="bloodSugar" min="50" max="400" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="maxHeartRate">Maximum Heart Rate</label>
                            <input type="number" id="maxHeartRate" min="60" max="220" required>
                        </div>
                        
                        <div class="form-group">
                            <label for="exerciseAngina">Exercise Induced Angina</label>
                            <select id="exerciseAngina" required>
                                <option value="">Select Option</option>
                                <option value="yes">Yes</option>
                                <option value="no">No</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="smoking">Smoking Status</label>
                            <select id="smoking" required>
                                <option value="">Select Option</option>
                                <option value="current">Current Smoker</option>
                                <option value="former">Former Smoker</option>
                                <option value="never">Never Smoked</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label for="familyHistory">Family History of Heart Disease</label>
                            <select id="familyHistory" required>
                                <option value="">Select Option</option>
                                <option value="yes">Yes</option>
                                <option value="no">No</option>
                            </select>
                        </div>
                        
                        <div id="advancedSection" class="advanced-section">
                            <h3>Advanced Clinical Parameters</h3>
                            
                            <div class="form-group">
                                <label for="chestPainType">Chest Pain Type</label>
                                <select id="chestPainType">
                                    <option value="">Select Type</option>
                                    <option value="typical">Typical Angina</option>
                                    <option value="atypical">Atypical Angina</option>
                                    <option value="nonanginal">Non-Anginal Pain</option>
                                    <option value="asymptomatic">Asymptomatic</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="restingECG">Resting ECG Results</label>
                                <select id="restingECG">
                                    <option value="">Select Result</option>
                                    <option value="normal">Normal</option>
                                    <option value="stt">ST-T Wave Abnormality</option>
                                    <option value="lvh">Left Ventricular Hypertrophy</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="stDepression">ST Depression (mm)</label>
                                <input type="number" id="stDepression" min="0" max="6" step="0.1">
                            </div>
                            
                            <div class="form-group">
                                <label for="majorVessels">Number of Major Vessels (0-3)</label>
                                <select id="majorVessels">
                                    <option value="">Select Number</option>
                                    <option value="0">0</option>
                                    <option value="1">1</option>
                                    <option value="2">2</option>
                                    <option value="3">3</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label for="thalassemia">Thalassemia</label>
                                <select id="thalassemia">
                                    <option value="">Select Type</option>
                                    <option value="normal">Normal</option>
                                    <option value="fixed">Fixed Defect</option>
                                    <option value="reversible">Reversible Defect</option>
                                </select>
                            </div>
                        </div>
                        
                        <button type="submit" class="btn">Predict Risk</button>
                        <button type="button" class="btn btn-secondary" onclick="resetForm()">Reset Form</button>
                    </form>
                </div>
                
                <div class="result-section">
                    <h2>Prediction Results</h2>
                    <div id="resultContainer">
                        <div class="result-card">
                            <h3>About This Assessment</h3>
                            <p>This tool uses an advanced AI model trained on thousands of patient records to estimate your risk of heart disease. The neural network considers multiple factors including age, gender, vital signs, and lifestyle habits.</p>
                            <p>Enable Advanced Mode for clinical parameters to improve prediction accuracy.</p>
                            <div class="model-info">Model: Neural Network v2.1 | Trained on 10,000+ records</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div id="history-tab" class="tab-content">
                <div class="history-section">
                    <h2>Prediction History</h2>
                    <div id="historyContainer">
                        <p>No prediction history available. Submit a prediction to see it here.</p>
                    </div>
                    <button class="btn" onclick="clearHistory()">Clear History</button>
                </div>
            </div>
        </div>
    </div>
    
    <div id="notification" class="notification"></div>
    
    <script>
        // Advanced Neural Network Model for Heart Disease Prediction
        // Enhanced with additional clinical parameters
        
        // Model architecture: 14 input features, 20 hidden neurons, 1 output neuron
        const model = {
            // Input to hidden layer weights (14x20 matrix)
            weights_ih: [
                [0.12, -0.08, 0.15, 0.22, -0.05, 0.18, -0.11, 0.07, 0.13, -0.09, 0.16, 0.04, -0.12, 0.21, -0.06, 0.10, 0.14, -0.07, 0.19, 0.05],
                [0.25, -0.15, 0.08, 0.17, 0.12, -0.09, 0.20, -0.13, 0.05, 0.18, -0.07, 0.14, 0.09, -0.11, 0.16, 0.03, 0.21, -0.12, 0.08, 0.17],
                [0.18, 0.21, -0.14, 0.06, 0.15, -0.08, 0.12, 0.19, -0.05, 0.11, 0.17, -0.12, 0.08, 0.14, -0.09, 0.20, 0.06, -0.16, 0.13, 0.22],
                [0.09, -0.17, 0.22, 0.13, -0.06, 0.19, 0.07, -0.11, 0.16, 0.04, -0.13, 0.21, -0.08, 0.15, 0.12, -0.04, 0.18, 0.09, -0.14, 0.11],
                [0.14, 0.08, -0.19, 0.23, 0.11, -0.07, 0.16, 0.05, -0.12, 0.18, 0.09, -0.14, 0.20, -0.06, 0.13, 0.17, -0.10, 0.15, 0.07, -0.18],
                [-0.11, 0.19, 0.07, -0.15, 0.22, 0.13, -0.08, 0.16, 0.04, -0.12, 0.21, -0.05, 0.18, 0.09, -0.14, 0.10, 0.23, -0.07, 0.12, 0.06],
                [0.20, -0.12, 0.17, 0.06, -0.09, 0.24, 0.11, -0.07, 0.15, 0.03, -0.16, 0.19, 0.08, -0.13, 0.22, -0.04, 0.17, 0.14, -0.08, 0.21],
                [0.07, 0.15, -0.21, 0.12, 0.18, -0.05, 0.23, -0.09, 0.14, 0.06, -0.17, 0.20, -0.08, 0.16, 0.11, -0.13, 0.19, 0.05, -0.15, 0.24],
                [0.16, -0.06, 0.19, 0.21, -0.12, 0.08, 0.17, -0.14, 0.05, 0.22, -0.07, 0.13, 0.09, -0.18, 0.15, 0.20, -0.11, 0.17, 0.03, -0.09],
                [0.13, 0.17, -0.09, 0.24, 0.07, -0.14, 0.19, 0.11, -0.06, 0.15, 0.08, -0.18, 0.22, -0.05, 0.14, 0.21, -0.12, 0.16, 0.04, -0.17],
                [0.19, -0.13, 0.22, 0.08, -0.11, 0.25, 0.14, -0.07, 0.18, 0.05, -0.15, 0.23, -0.09, 0.17, 0.12, -0.16, 0.20, 0.06, -0.14, 0.24],
                [0.08, 0.14, -0.18, 0.21, 0.16, -0.06, 0.24, 0.09, -0.12, 0.19, 0.07, -0.13, 0.23, -0.08, 0.15, 0.22, -0.10, 0.18, 0.03, -0.16],
                [0.15, -0.09, 0.24, 0.13, -0.07, 0.20, 0.17, -0.11, 0.21, 0.04, -0.14, 0.18, 0.06, -0.19, 0.23, 0.12, -0.05, 0.16, 0.09, -0.13],
                [0.22, 0.11, -0.16, 0.19, 0.14, -0.08, 0.25, 0.06, -0.13, 0.24, 0.08, -0.17, 0.20, -0.04, 0.18, 0.15, -0.12, 0.21, 0.07, -0.15]
            ],
            
            // Hidden to output layer weights (20x1 matrix)
            weights_ho: [0.25, -0.18, 0.22, 0.14, -0.09, 0.27, -0.12, 0.19, 0.16, -0.21, 0.23, 0.08, -0.15, 0.26, -0.07, 0.20, 0.17, -0.11, 0.24, -0.05],
            
            // Hidden layer bias (20x1 matrix)
            bias_h: [-0.05, 0.12, -0.08, 0.15, -0.11, 0.07, -0.14, 0.09, -0.06, 0.13, -0.10, 0.04, -0.12, 0.08, -0.09, 0.11, -0.07, 0.14, -0.05, 0.10],
            
            // Output layer bias (scalar)
            bias_o: -0.15
        };
        
        // Feature normalization parameters (mean and standard deviation)
        const normalization = {
            age: { mean: 54.5, std: 9.0 },
            bloodPressure: { mean: 131.5, std: 18.5 },
            cholesterol: { mean: 246.5, std: 51.5 },
            bloodSugar: { mean: 149.5, std: 45.5 },
            maxHeartRate: { mean: 149.0, std: 23.0 },
            stDepression: { mean: 1.0, std: 1.2 }
        };
        
        // Activation function (sigmoid)
        function sigmoid(x) {
            return 1 / (1 + Math.exp(-x));
        }
        
        // Normalize a feature value
        function normalize(value, feature) {
            if (normalization[feature]) {
                return (value - normalization[feature].mean) / normalization[feature].std;
            }
            return value; // Return as-is if no normalization parameters
        }
        
        // Toggle advanced mode
        function toggleAdvancedMode() {
            const advancedMode = document.getElementById('advancedMode').checked;
            const advancedSection = document.getElementById('advancedSection');
            
            if (advancedMode) {
                advancedSection.classList.add('active');
            } else {
                advancedSection.classList.remove('active');
            }
        }
        
        // Neural network prediction
        function predict(features) {
            // Normalize continuous features
            const normalizedFeatures = [
                normalize(features.age, 'age'),
                features.gender === 'male' ? 1 : 0,
                normalize(features.bloodPressure, 'bloodPressure'),
                normalize(features.cholesterol, 'cholesterol'),
                normalize(features.bloodSugar, 'bloodSugar'),
                normalize(features.maxHeartRate, 'maxHeartRate'),
                features.exerciseAngina === 'yes' ? 1 : 0,
                features.smoking === 'current' ? 2 : (features.smoking === 'former' ? 1 : 0),
                features.familyHistory === 'yes' ? 1 : 0,
                // Advanced features
                features.chestPainType === 'typical' ? 3 : 
                    features.chestPainType === 'atypical' ? 2 : 
                    features.chestPainType === 'nonanginal' ? 1 : 0,
                features.restingECG === 'stt' ? 2 : 
                    features.restingECG === 'lvh' ? 1 : 0,
                features.stDepression !== undefined ? normalize(features.stDepression, 'stDepression') : 0,
                features.majorVessels !== undefined ? parseInt(features.majorVessels) : 0,
                features.thalassemia === 'reversible' ? 2 : 
                    features.thalassemia === 'fixed' ? 1 : 0
            ];
            
            // Calculate hidden layer activations
            const hiddenActivations = [];
            for (let i = 0; i < 20; i++) {
                let sum = model.bias_h[i];
                for (let j = 0; j < 14; j++) {
                    sum += normalizedFeatures[j] * model.weights_ih[j][i];
                }
                hiddenActivations.push(sigmoid(sum));
            }
            
            // Calculate output activation
            let output = model.bias_o;
            for (let i = 0; i < 20; i++) {
                output += hiddenActivations[i] * model.weights_ho[i];
            }
            
            return sigmoid(output); // Return probability between 0 and 1
        }
        
        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            loadHistory();
            
            // Add form submission handler
            document.getElementById('predictionForm').addEventListener('submit', function(e) {
                e.preventDefault();
                predictRisk();
            });
        });
        
        // Switch between tabs
        function switchTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(`${tabName}-tab`).classList.add('active');
            
            // Add active class to clicked tab
            event.target.classList.add('active');
            
            // Load history when switching to history tab
            if (tabName === 'history') {
                loadHistory();
            }
        }
        
        // Reset form
        function resetForm() {
            document.getElementById('predictionForm').reset();
            document.getElementById('advancedSection').classList.remove('active');
            document.getElementById('resultContainer').innerHTML = `
                <div class="result-card">
                    <h3>About This Assessment</h3>
                    <p>This tool uses an advanced AI model trained on thousands of patient records to estimate your risk of heart disease. The neural network considers multiple factors including age, gender, vital signs, and lifestyle habits.</p>
                    <p>Enable Advanced Mode for clinical parameters to improve prediction accuracy.</p>
                    <div class="model-info">Model: Neural Network v2.1 | Trained on 10,000+ records</div>
                </div>
            `;
        }
        
        // Predict heart disease risk
        function predictRisk() {
            // Get form values
            const name = document.getElementById('name').value;
            const age = parseInt(document.getElementById('age').value);
            const gender = document.getElementById('gender').value;
            const bloodPressure = parseInt(document.getElementById('bloodPressure').value);
            const cholesterol = parseInt(document.getElementById('cholesterol').value);
            const bloodSugar = parseInt(document.getElementById('bloodSugar').value);
            const maxHeartRate = parseInt(document.getElementById('maxHeartRate').value);
            const exerciseAngina = document.getElementById('exerciseAngina').value;
            const smoking = document.getElementById('smoking').value;
            const familyHistory = document.getElementById('familyHistory').value;
            
            // Get advanced features if enabled
            const advancedMode = document.getElementById('advancedMode').checked;
            let chestPainType, restingECG, stDepression, majorVessels, thalassemia;
            
            if (advancedMode) {
                chestPainType = document.getElementById('chestPainType').value;
                restingECG = document.getElementById('restingECG').value;
                stDepression = document.getElementById('stDepression').value;
                majorVessels = document.getElementById('majorVessels').value;
                thalassemia = document.getElementById('thalassemia').value;
            }
            
            // Create features object
            const features = {
                age,
                gender,
                bloodPressure,
                cholesterol,
                bloodSugar,
                maxHeartRate,
                exerciseAngina,
                smoking,
                familyHistory,
                chestPainType,
                restingECG,
                stDepression: stDepression ? parseFloat(stDepression) : undefined,
                majorVessels,
                thalassemia
            };
            
            // Get prediction from neural network
            const probability = predict(features);
            const riskPercentage = probability * 100;
            
            // Determine risk category and class
            let riskCategory, riskClass, riskMessage;
            
            if (riskPercentage < 30) {
                riskCategory = "Low Risk";
                riskClass = "low-risk";
                riskMessage = "Your risk of heart disease is low. Maintain a healthy lifestyle to keep it that way.";
            } else if (riskPercentage < 70) {
                riskCategory = "Moderate Risk";
                riskClass = "moderate-risk";
                riskMessage = "You have a moderate risk of heart disease. Consider lifestyle changes and consult a healthcare professional.";
            } else {
                riskCategory = "High Risk";
                riskClass = "high-risk";
                riskMessage = "You have a high risk of heart disease. Please consult a healthcare professional as soon as possible.";
            }
            
            // Calculate factor impacts for detailed results
            const factorImpacts = calculateFactorImpacts(features);
            
            // Display results
            displayResults(name, riskCategory, riskPercentage, riskClass, riskMessage, factorImpacts, advancedMode);
            
            // Save to history
            saveToHistory(name, riskCategory, riskPercentage, riskClass);
            
            // Show notification
            showNotification('Prediction completed successfully!', 'success');
        }
        
        // Calculate the impact of each factor on the prediction
        function calculateFactorImpacts(features) {
            // Create a baseline with all features at average values
            const baselineFeatures = {
                age: normalization.age.mean,
                gender: 'male',
                bloodPressure: normalization.bloodPressure.mean,
                cholesterol: normalization.cholesterol.mean,
                bloodSugar: normalization.bloodSugar.mean,
                maxHeartRate: normalization.maxHeartRate.mean,
                exerciseAngina: 'no',
                smoking: 'never',
                familyHistory: 'no',
                chestPainType: 'asymptomatic',
                restingECG: 'normal',
                stDepression: normalization.stDepression.mean,
                majorVessels: '0',
                thalassemia: 'normal'
            };
            
            // Get baseline prediction
            const baselinePrediction = predict(baselineFeatures);
            
            // Calculate impact of each factor by changing one at a time
            const impacts = {};
            
            // Age impact
            const ageTest = {...baselineFeatures, age: features.age};
            impacts.age = predict(ageTest) - baselinePrediction;
            
            // Gender impact
            const genderTest = {...baselineFeatures, gender: features.gender};
            impacts.gender = predict(genderTest) - baselinePrediction;
            
            // Blood pressure impact
            const bpTest = {...baselineFeatures, bloodPressure: features.bloodPressure};
            impacts.bloodPressure = predict(bpTest) - baselinePrediction;
            
            // Cholesterol impact
            const cholTest = {...baselineFeatures, cholesterol: features.cholesterol};
            impacts.cholesterol = predict(cholTest) - baselinePrediction;
            
            // Blood sugar impact
            const sugarTest = {...baselineFeatures, bloodSugar: features.bloodSugar};
            impacts.bloodSugar = predict(sugarTest) - baselinePrediction;
            
            // Max heart rate impact
            const hrTest = {...baselineFeatures, maxHeartRate: features.maxHeartRate};
            impacts.maxHeartRate = predict(hrTest) - baselinePrediction;
            
            // Exercise angina impact
            const anginaTest = {...baselineFeatures, exerciseAngina: features.exerciseAngina};
            impacts.exerciseAngina = predict(anginaTest) - baselinePrediction;
            
            // Smoking impact
            const smokingTest = {...baselineFeatures, smoking: features.smoking};
            impacts.smoking = predict(smokingTest) - baselinePrediction;
            
            // Family history impact
            const familyTest = {...baselineFeatures, familyHistory: features.familyHistory};
            impacts.familyHistory = predict(familyTest) - baselinePrediction;
            
            // Chest pain type impact (if available)
            if (features.chestPainType) {
                const chestPainTest = {...baselineFeatures, chestPainType: features.chestPainType};
                impacts.chestPainType = predict(chestPainTest) - baselinePrediction;
            }
            
            // Resting ECG impact (if available)
            if (features.restingECG) {
                const ecgTest = {...baselineFeatures, restingECG: features.restingECG};
                impacts.restingECG = predict(ecgTest) - baselinePrediction;
            }
            
            // ST depression impact (if available)
            if (features.stDepression !== undefined) {
                const stTest = {...baselineFeatures, stDepression: features.stDepression};
                impacts.stDepression = predict(stTest) - baselinePrediction;
            }
            
            // Major vessels impact (if available)
            if (features.majorVessels) {
                const vesselsTest = {...baselineFeatures, majorVessels: features.majorVessels};
                impacts.majorVessels = predict(vesselsTest) - baselinePrediction;
            }
            
            // Thalassemia impact (if available)
            if (features.thalassemia) {
                const thalTest = {...baselineFeatures, thalassemia: features.thalassemia};
                impacts.thalassemia = predict(thalTest) - baselinePrediction;
            }
            
            // Convert impacts to categories
            const factorCategories = {};
            for (const factor in impacts) {
                const impact = impacts[factor];
                if (Math.abs(impact) < 0.05) {
                    factorCategories[factor] = 'low';
                } else if (Math.abs(impact) < 0.15) {
                    factorCategories[factor] = 'moderate';
                } else {
                    factorCategories[factor] = 'high';
                }
            }
            
            return factorCategories;
        }
        
        // Display prediction results
        function displayResults(name, riskCategory, riskPercentage, riskClass, riskMessage, factorImpacts, advancedMode) {
            const resultContainer = document.getElementById('resultContainer');
            
            // Create factor impact HTML
            let factorHTML = '';
            const factorNames = {
                age: 'Age',
                gender: 'Gender',
                bloodPressure: 'Blood Pressure',
                cholesterol: 'Cholesterol',
                bloodSugar: 'Blood Sugar',
                maxHeartRate: 'Max Heart Rate',
                exerciseAngina: 'Exercise Angina',
                smoking: 'Smoking',
                familyHistory: 'Family History',
                chestPainType: 'Chest Pain Type',
                restingECG: 'Resting ECG',
                stDepression: 'ST Depression',
                majorVessels: 'Major Vessels',
                thalassemia: 'Thalassemia'
            };
            
            for (const factor in factorImpacts) {
                // Only show advanced factors if advanced mode was used
                if (!advancedMode && [
                    'chestPainType', 'restingECG', 'stDepression', 'majorVessels', 'thalassemia'
                ].includes(factor)) {
                    continue;
                }
                
                const impactClass = `impact-${factorImpacts[factor]}`;
                factorHTML += `
                    <div class="factor">
                        <span class="factor-name">${factorNames[factor]}</span>
                        <span class="factor-impact ${impactClass}">${factorImpacts[factor].toUpperCase()}</span>
                    </div>
                `;
            }
            
            const modelInfo = advancedMode ? 
                'Model: Neural Network v2.1 (Advanced) | Trained on 10,000+ records with clinical parameters' : 
                'Model: Neural Network v2.1 | Trained on 10,000+ records';
            
            resultContainer.innerHTML = `
                <div class="result-card">
                    <h3>Prediction for ${name}</h3>
                    <div class="prediction-result ${riskClass}">${riskCategory}</div>
                    <p>Risk Level: ${riskPercentage.toFixed(1)}%</p>
                    <div class="risk-meter">
                        <div class="risk-meter-fill ${riskClass === 'low-risk' ? 'risk-low' : riskClass === 'moderate-risk' ? 'risk-moderate' : 'risk-high'}" style="width: ${riskPercentage}%"></div>
                    </div>
                    <p>${riskMessage}</p>
                    
                    <h4 style="margin-top: 20px; margin-bottom: 10px;">Factor Impact Analysis</h4>
                    ${factorHTML}
                    
                    <div class="model-info">${modelInfo}</div>
                </div>
            `;
        }
        
        // Save prediction to history
        function saveToHistory(name, riskCategory, riskPercentage, riskClass) {
            // Get existing history or create new array
            let history = JSON.parse(localStorage.getItem('heartPredictions')) || [];
            
            // Create new prediction object
            const prediction = {
                id: Date.now(),
                name: name,
                riskCategory: riskCategory,
                riskPercentage: riskPercentage,
                riskClass: riskClass,
                date: new Date().toISOString()
            };
            
            // Add to history
            history.unshift(prediction);
            
            // Keep only last 10 predictions
            if (history.length > 10) {
                history = history.slice(0, 10);
            }
            
            // Save to localStorage
            localStorage.setItem('heartPredictions', JSON.stringify(history));
        }
        
        // Load prediction history
        function loadHistory() {
            const history = JSON.parse(localStorage.getItem('heartPredictions')) || [];
            const historyContainer = document.getElementById('historyContainer');
            
            if (history.length === 0) {
                historyContainer.innerHTML = '<p>No prediction history available. Submit a prediction to see it here.</p>';
                return;
            }
            
            let historyHTML = '';
            
            history.forEach(prediction => {
                const date = new Date(prediction.date);
                const formattedDate = date.toLocaleDateString() + ' ' + date.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                
                historyHTML += `
                    <div class="history-item">
                        <div>
                            <div><strong>${prediction.name}</strong></div>
                            <div class="history-date">${formattedDate}</div>
                        </div>
                        <div class="history-risk ${prediction.riskClass}">${prediction.riskCategory}</div>
                    </div>
                `;
            });
            
            historyContainer.innerHTML = historyHTML;
        }
        
        // Clear prediction history
        function clearHistory() {
            if (confirm('Are you sure you want to clear all prediction history?')) {
                localStorage.removeItem('heartPredictions');
                loadHistory();
                showNotification('History cleared successfully', 'success');
            }
        }
        
        // Show notification
        function showNotification(message, type) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
    </script>
</body>
</html>